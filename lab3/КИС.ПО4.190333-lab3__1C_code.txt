
Процедура КнопкаВыполнитьНажатие(Кнопка)
	// Вставить содержимое обработчика.
		Состояние("Формируется таблица МЦ");
	
	Если Номенклатура.Количество() > 0 Тогда
		Номенклатура.Очистить();
	КонецЕсли;
	
	Если СписокЕИ.Количество() > 0 Тогда
		СписокЕИ.Очистить();
	КонецЕсли;
	
	Парсер = Новый ЧтениеXML;
	Парсер.ОткрытьФайл(ПутьКБазеДанных);
	
	Пока Парсер.Прочитать() Цикл
		Если Парсер.ТипУзла = ТипУзлаXML.НачалоЭлемента и Парсер.Имя = "Collection" Тогда
			Группа = Парсер.ЗначениеАтрибута("caption");
			Если Группа = "Матценности" Тогда
				Пока Парсер.Прочитать() Цикл // <Collection>
					Если Парсер.ТипУзла = ТипУзлаXML.НачалоЭлемента И Парсер.Имя = "Object" Тогда
						Стр = Номенклатура.Добавить();
						Пока Парсер.Прочитать() Цикл // <Object>
							Если Парсер.ТипУзла = ТипУзлаXML.НачалоЭлемента И Парсер.Имя = "Collection" Тогда
								Пока Парсер.Прочитать() Цикл // <Collection>
									Если Парсер.ТипУзла = ТипУзлаXML.НачалоЭлемента И Парсер.Имя = "prop_value" Тогда
										Название = Парсер.ЗначениеАтрибута("prop_name");
										Если Название = "BarKod" Тогда
											Значение = Парсер.ЗначениеАтрибута("value");
											Если Значение <> Неопределено Тогда
												Стр.Код = Значение;	
											КонецЕсли;	
										КонецЕсли;
										Если Название = "Name" Тогда
											Значение = Парсер.ЗначениеАтрибута("value");
											Если Значение <> Неопределено Тогда
												Стр.Наименование = Значение;	
											КонецЕсли;
										КонецЕсли;
										Если Название = "cED" Тогда
											Значение = Парсер.ЗначениеАтрибута("value");
											Если Значение <> Неопределено Тогда
												Стр.ЕИ = Значение;	
											КонецЕсли;
										КонецЕсли;
									ИначеЕсли Парсер.ТипУзла = ТипУзлаXML.КонецЭлемента И Парсер.Имя = "Collection" Тогда
										Прервать;
									КонецЕсли;
								КонецЦикла;
							ИначеЕсли Парсер.ТипУзла = ТипУзлаXML.КонецЭлемента И Парсер.Имя = "Object" Тогда
								Прервать;
							КонецЕсли;
						КонецЦикла;
					ИначеЕсли Парсер.ТипУзла = ТипУзлаXML.КонецЭлемента И Парсер.Имя = "Collection" Тогда
						Прервать;
					КонецЕсли;
				КонецЦикла;
			ИначеЕсли Группа = "Единицы измерения" Тогда
				Пока Парсер.Прочитать() Цикл // <Collection>
					Если Парсер.ТипУзла = ТипУзлаXML.НачалоЭлемента И Парсер.Имя = "Object" Тогда
						Стр = СписокЕИ.Добавить();
						Код = Парсер.ЗначениеАтрибута("id");
						Если Код <> Неопределено Тогда
							Стр.КодЕИ = Код;
						КонецЕсли;
						Пока Парсер.Прочитать() Цикл // <Object>
							Если Парсер.ТипУзла = ТипУзлаXML.НачалоЭлемента И Парсер.Имя = "Collection" Тогда
								Пока Парсер.Прочитать() Цикл // <Collection>
									Если Парсер.ТипУзла = ТипУзлаXML.НачалоЭлемента И Парсер.Имя = "prop_value" Тогда
										Название = Парсер.ЗначениеАтрибута("prop_name");
										Если Название = "Name" Тогда
											Значение = Парсер.ЗначениеАтрибута("value");
											Если Значение <> Неопределено Тогда
												Стр.ПолноеНаимЕИ = Значение;	
											КонецЕсли;	
										КонецЕсли;
										Если Название = "Abbr" Тогда
											Значение = Парсер.ЗначениеАтрибута("value");
											Если Значение <> Неопределено Тогда
												Стр.НаименованиеЕИ = Значение;	
											КонецЕсли;
										КонецЕсли;
									ИначеЕсли Парсер.ТипУзла = ТипУзлаXML.КонецЭлемента И Парсер.Имя = "Collection" Тогда
										Прервать;
									КонецЕсли;
								КонецЦикла;
							ИначеЕсли Парсер.ТипУзла = ТипУзлаXML.КонецЭлемента И Парсер.Имя = "Object" Тогда
								Прервать;
							КонецЕсли;
						КонецЦикла;
					ИначеЕсли Парсер.ТипУзла = ТипУзлаXML.КонецЭлемента И Парсер.Имя = "Collection" Тогда
						Прервать;
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	Парсер.Закрыть();
		
	Для Каждого Стр Из Номенклатура Цикл
		НомЭлемент = Справочники.Номенклатура.СоздатьЭлемент();
		НомЭлемент.Код = Стр.Код;
		НомЭлемент.Наименование = Стр.Наименование;
		НомЭлемент.НаименованиеПолное = Стр.Наименование;
		ЕдИзм = СписокЕИ.Найти(Стр.ЕИ, "КодЕИ");
		Если ЕдИзм <> Неопределено Тогда
			ЕИ = Справочники.КлассификаторЕдиницИзмерения.НайтиПоНаименованию(ЕдИзм.НаименованиеЕИ);
			Если НЕ ЕИ.Пустая() Тогда
				НомЭлемент.ЕдиницаИзмерения = ЕИ;	
			КонецЕсли;
		КонецЕсли;
		НомЭлемент.Записать();
	КонецЦикла;
КонецПроцедуры

Процедура ПутьКБазеДанныхНачалоВыбора(Элемент, СтандартнаяОбработка)
	// Вставить содержимое обработчика.
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	Диалог.ПолноеИмяФайла = ПутьКБазеДанных;
	Если Диалог.Выбрать() Тогда
		ПутьКБазеДанных = Диалог.ПолноеИмяФайла;
	КонецЕсли;
КонецПроцедуры
