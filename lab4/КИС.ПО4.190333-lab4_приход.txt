
Процедура КнопкаСформироватьНажатие(Кнопка) 
	Запрос = Новый Запрос;
	
	Запрос.Текст = "ВЫБРАТЬ
	               |	ПоступлениеТоваровУслуг.Номер,
	               |	ПоступлениеТоваровУслугТовары.Цена,
	               |	ПоступлениеТоваровУслугТовары.Количество КАК Количество,
	               |	ПоступлениеТоваровУслугТовары.Сумма КАК Сумма,
	               |	ПоступлениеТоваровУслугТовары.Номенклатура КАК Номенклатура,
	               |	ПоступлениеТоваровУслуг.Контрагент КАК Контрагент
	               |ИЗ
	               |	Документ.ПоступлениеТоваровУслуг.Товары КАК ПоступлениеТоваровУслугТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеТоваровУслуг КАК ПоступлениеТоваровУслуг
	               |		ПО ПоступлениеТоваровУслугТовары.Ссылка = ПоступлениеТоваровУслуг.Ссылка
	               |ГДЕ
	               |	ПоступлениеТоваровУслуг.Дата >= &ДатаС
	               |	И ПоступлениеТоваровУслуг.Дата <= &ДатаПо
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Контрагент,
	               |	ПоступлениеТоваровУслугТовары.Номенклатура
	               |ИТОГИ
	               |	СУММА(Количество),
	               |	СУММА(Сумма)
	               |ПО
	               |	Контрагент,
	               |	Номенклатура";
					
	Запрос.УстановитьПараметр("ДатаС", НачалоДня(ДатаС));
	Запрос.УстановитьПараметр("ДатаПо", КонецДня(ДатаПо));
	РезультатЗапроса = Запрос.Выполнить().Выгрузить();
	
	ТабДок = ЭлементыФормы.ПолеТабличногоДокумента2;
	ТабДок.Очистить();
	
	Макет = ПолучитьМакет("Макет1");
	Шапка 		= Макет.ПолучитьОбласть("Шапка");
	Уровень1 	= Макет.ПолучитьОбласть("Уровень1");
	Уровень2 	= Макет.ПолучитьОбласть("Уровень2");
	Уровень3 	= Макет.ПолучитьОбласть("Уровень3");
	Подвал 		= Макет.ПолучитьОбласть("Подвал");
	Шапка.Параметры.ДатаС = Формат(ДатаС, "ДФ=""дд.ММ.гггг""");
	Шапка.Параметры.ДатаПо = Формат(ДатаПо, "ДФ=""дд.ММ.гггг""");
	ТабДок.Вывести(Шапка);
	ТабДок.ФиксацияСверху = Шапка.ВысотаТаблицы;
	
	ТабДок.НачатьАвтогруппировкуСтрок();
	ПревКонтрагент = Неопределено;
	ПредНоменклатура = Неопределено;
	СуммаИт = 0;
	Для Каждого СтрокаТЗ Из РезультатЗапроса Цикл
		Если ПревКонтрагент = Неопределено ИЛИ СтрокаТЗ.Контрагент <> ПревКонтрагент Тогда
			ПревКонтрагент = СтрокаТЗ.Контрагент;
			ПревНоменклатура = Неопределено;
			Уровень1.Параметры.Контрагент = СтрокаТЗ.Контрагент;
			Уровень1.Параметры.Сумма = СтрокаТЗ.Сумма;
			ТабДок.Вывести(Уровень1, 1);
			Продолжить;
		КонецЕсли;
		Если ПревНоменклатура = Неопределено ИЛИ СтрокаТЗ.Номенклатура <> ПревНоменклатура Тогда
			ПревНоменклатура = СтрокаТЗ.Номенклатура;
			Уровень2.Параметры.Код 			= СтрокаТЗ.Номенклатура.Код;
			Уровень2.Параметры.Номенклатура = СтрокаТЗ.Номенклатура;
			Уровень2.Параметры.ЕдИзм 		= СтрокаТЗ.Номенклатура.ЕдиницаИзмерения;
			Уровень2.Параметры.Количество 	= СтрокаТЗ.Количество;
			Уровень2.Параметры.Сумма 		= СтрокаТЗ.Сумма;
			ТабДок.Вывести(Уровень2, 2);
			Продолжить;
		КонецЕсли;
		Если НЕ (СтрокаТЗ.Количество = 0 И СтрокаТЗ.Сумма = 0) Тогда
			Уровень3.Параметры.Цена			= СтрокаТЗ.Цена;
			Уровень3.Параметры.Номер 		= СтрокаТЗ.Номер;
			Уровень3.Параметры.Количество 	= СтрокаТЗ.Количество;
			Уровень3.Параметры.Сумма 		= СтрокаТЗ.Сумма;
			ТабДок.Вывести(Уровень3, 3);
			СуммаИт = СуммаИт + СтрокаТЗ.Сумма;
		КонецЕсли;	
	КонецЦикла;
	ТабДок.ЗакончитьАвтогруппировкуСтрок();
	УровеньАвтогруппировки = 1;
	ТабДок.ПоказатьУровеньГруппировокСтрок(УровеньАвтогруппировки);
	Подвал.Параметры.Сумма = СуммаИт;
	ТабДок.Вывести(Подвал, 1);
	ТабДок.Показать();
КонецПроцедуры  

Процедура ПередОткрытием()  
	ДатаС = НачалоМесяца(РабочаяДата);
	ДатаПо = КонецМесяца(РабочаяДата);
КонецПроцедуры
